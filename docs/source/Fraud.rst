*****
Fraud
*****

============
Introduction
============

Packages
========

    * :py:mod:`pandas` version 0.19.2
    * :py:mod:`sklearn` version 0.18.1
    * :py:mod:`statsmodels` version 0.6.1
    * :py:mod:`imblearn.combine` version 0.1.8

Note
    pandas and imblearn currently support intersphinx, I have not been able to get sklearn or statsmodel to automatically hyperlink out but it's a work in progress.

Notes on Fraud Analysis
========================

Why Fraud detection is an exciting and interesting space for machine learning!

    * **Combative**: If a fraud attempt is detected the fraudster will likely choose a different approach for her or his next attempt.
    * **Class Imbalance** Fraud detection requires prediction based on massively disparate class representation (typically most actors are not fraudsters)
    * **Profit-Loss & Concavity**: While absent here because fraud costs are not available, custom metrics combining profit and loss (both monetary, and opportunity/growth based) yield loss functions which are not typically convex

Data Design
===========

To merge the information from the risks table into the companies table I created a composite key in the risk table
of the form {*signal_group*}{*metric_type*}{*score_value*} to reduce overhead. Next I grouped the risk metrics
by *company_id* and *composite key* and summed the *n_scores* to aggregate the number of risk metric events per company and composite key.
I then dummified the *composite key* field, multiplied the summed *n_score* field into the dummification so I could group again by *company_id* and sum again to pivot and attach the different combinations of signal / metric / score type to the *company_id* which allowed me to JOIN the the aggregated risk table to the companies table. Note a database style merge was used of the form **companies** LEFT JOIN **risk** and then 0 filled so in case in the future if *company_id* fields do not appear in the
risk table the data is not dropped due to an INNER JOIN.

I converted the field *bank_acount_type* to a boolean field (Checking := 1, Saving := 0.)
I added two fields with respect to employees and employee location, the perecent of employees in the 
home state of the company, *percent_state*, and a boolean field for companies with an employee count > 0 (1 := > 0, 0 := 0) *has_employees*

for more information see :py:class:`gusto.src.preprocessor.Reader` and :py:class:`gusto.src.preprocessor.RiskData` 

Train Test Split
================

After data merging 30 % of the data is split off for a validation set. Because data is aggregated by *company_id* during merging, which is a **primary key** in the table after merging and then split 
by *company_id* the training set is guarded against target leakage (the data merging here is independent of the target). The subsequent analysis pertains
only to the training set until the evaluation of models against the test is discussed.

Imbalance Resampling
====================

To combat **Class Imbalance** I resampled the data using *SMOTE + ENN* which creates new data points of the minority class with SMOTE and then undersamples
based on verification via KNN(N=3) of the oversampled set. Undersampling techniques should be explored here in the future but for this introductory analysis I did not exlore farther. Research can be leveraged here to improve modeling capabilities and understanding, for more information see http://dl.acm.org/citation.cfm?id=1007735.

for more information please see :py:class:`imblearn.combine.SMOTEENN`

EDA
===

Exploring the data begins with a high level correlation analysis to evaluate relationships within the data as well as to the target.

The following table is represented in two heatmap forms where index/columns order is preserved. Apologies that this is not the easiest data representation
to work with, but moving forward, if having this data available for wider consumption is desired, a dashboard can be built and the information between the
table and figures can be linked, as well as dynamically aggregated and filtered


========================================  =============  ===============  ======================  ==========================  ===================  ============  =================  ==================  ===============  ===============  =================================  ========================================  ======================================  =======================================  =======================================  ================================  ==============================  ===========================  ===============================  ===========================  =============================  ==========================  ==============================  =========================================  ==========================================  =================================  ==================================  ====================================  ==================================  =================================  ===================================  ====================================  ========================================  =====================================  =========================================  =========================================  ==================================  ===================================  =========================================  ======================================  ==========================================  ==========================================  =====================================  ===================================  ==================================  ==============================  ==================================
index                                        company_id    num_employees    num_ee_state_matches    num_bank_account_changes    bank_account_type       has_ibv    num_accountants    num_nacha_errors    percent_state    has_employees    key_admin_DistanceFromWork_Good    key_admin_EmailageVerification_Warning    key_admin_KnownFraudulentData_Danger    key_admin_KnownFraudulentData_Neutral    key_admin_KnownFraudulentData_Warning    key_admin_Threatmetrix_Neutral    key_admin_TorExitNode_Danger    key_admin_TorExitNode_NaN    key_admin_TorExitNode_Neutral    key_admin_WebPresence_NaN    key_company_BankRisk_Danger    key_company_BankRisk_NaN    key_company_BankRisk_Neutral    key_company_DuplicateBankAccount_Danger    key_company_DuplicateBankAccount_Neutral    key_company_DuplicateEin_Danger    key_company_DuplicateEin_Neutral    key_company_EinVerification_Danger    key_company_EinVerification_Good    key_company_EinVerification_NaN    key_company_FastOnboarding_Danger    key_company_FastOnboarding_Neutral    key_company_KnownFraudulentData_Danger    key_company_KnownFraudulentData_NaN    key_company_KnownFraudulentData_Neutral    key_company_KnownFraudulentData_Warning    key_employee_DuplicateSsn_Danger    key_employee_DuplicateSsn_Neutral    key_employee_KnownFraudulentData_Danger    key_employee_KnownFraudulentData_NaN    key_employee_KnownFraudulentData_Neutral    key_employee_KnownFraudulentData_Warning    key_employee_SsnVerification_Danger    key_employee_SsnVerification_Good    key_employee_SsnVerification_NaN    key_employee_TorExitNode_NaN    key_employee_TorExitNode_Neutral
========================================  =============  ===============  ======================  ==========================  ===================  ============  =================  ==================  ===============  ===============  =================================  ========================================  ======================================  =======================================  =======================================  ================================  ==============================  ===========================  ===============================  ===========================  =============================  ==========================  ==============================  =========================================  ==========================================  =================================  ==================================  ====================================  ==================================  =================================  ===================================  ====================================  ========================================  =====================================  =========================================  =========================================  ==================================  ===================================  =========================================  ======================================  ==========================================  ==========================================  =====================================  ===================================  ==================================  ==============================  ==================================
company_id                                  1               -0.0138306               0.000731239                  0.0511276           -0.0271673    -0.0358464         -0.0202141          -0.0879775       -0.00991551      0.0762975                          0.00652735                                0.00652735                              0.00715942                               0.00423053                                       nan                       0.00652735                              nan                 -0.000457844                      0.00457269                   0.00652735                     0.0975446                  -0.00650335                       0.00818886                                 0.0486263                                  -0.048541                         -0.00191873                          0.023057                              0.151786                           -0.0592544                         -0.0453898                            0.0720017                            -0.0828083                                  0.0774976                            -0.00918487                                 -0.0620193                                 0.00615136                         -0.0282306                            0.0134041                                   0.0325799                             -0.00652819                                 -0.0303068                                   0.110036                               0.100372                            -0.0102386                          -0.0032464                               nan                        -0.0253915
num_employees                              -0.0138306        1                       0.975509                    -0.00882519           0.0655994    -0.0636338          0.0455546           0.114251        -0.0127598      -0.0124266                          0.000685183                               0.000685183                             0.00689366                               0.0123477                                        nan                       0.000685183                             nan                  0.00591293                       0.0109171                    0.000685183                   -0.0399741                  -0.00268032                      -0.00641079                                -0.0495403                                   0.0480276                        -0.0365406                           0.00123305                           -0.0414187                           0.0192573                         -0.0116852                           -0.079155                              0.0611272                                  0.0294247                            -0.00126986                                  0.0969731                                 0.0266476                           0.202791                             0.830339                                    0.332714                               0.0120536                                   0.651146                                    0.154056                               0.450348                             0.79009                             0.0624301                               nan                         0.327251
num_ee_state_matches                        0.000731239      0.975509                1                           -0.0225621            0.0682398    -0.0762865          0.0512935           0.0721846        0.0869734      -0.00245278                         0.0014163                                 0.0014163                               0.00458373                               0.00946112                                       nan                       0.0014163                               nan                  0.00604424                       0.00792805                   0.0014163                     -0.039307                   -0.00231908                      -0.0117447                                 -0.0512066                                   0.0495965                        -0.0341136                           0.00354929                           -0.0392565                           0.0247981                         -0.0234295                           -0.0919141                             0.0739978                                  0.0162416                            -0.00195503                                  0.0428442                                 0.0264967                           0.19332                              0.838248                                    0.310708                               0.0128327                                   0.634062                                    0.173475                               0.461706                             0.794088                            0.0528972                               nan                         0.309721
num_bank_account_changes                    0.0511276       -0.00882519             -0.0225621                    1                    0.018499      0.0314741         -0.079625            0.284872        -0.108289        0.0107                             0.00846009                                0.00846009                              0.00957093                              -0.0162959                                        nan                       0.00846009                              nan                 -0.00514076                      -0.0150928                    0.00846009                     0.0663651                  -0.00407904                       0.586742                                   0.0268108                                  -0.0247119                         0.00390647                         -0.0318487                             0.0746648                          -0.091533                           0.0895435                            0.110934                              0.0111548                                  0.204738                             -0.00235496                                 -0.0558747                                -0.00407904                          0.0103034                           -0.0301183                                   0.0300892                             -0.00235496                                 -0.0226445                                  -0.0183651                              0.0323645                           -0.0286453                          -0.00279517                              nan                        -0.0165556
bank_account_type                          -0.0271673        0.0655994               0.0682398                    0.018499             1            -0.0557956          0.0975871          -0.0169929        0.0372913      -0.0189549                          0.00260393                                0.00260393                              0.00982705                               0.0207977                                        nan                       0.00260393                              nan                  0.0032817                        0.0191014                    0.00260393                     0.0271259                   0.00260393                       0.0314738                                 -0.346178                                    0.339397                          0.0205297                          -0.0105137                            -0.091664                           -0.00111229                         0.00761551                          -0.18791                               0.186053                                  -0.0472078                             0.00150333                                 -0.00738817                                0.00260393                          0.0149156                            0.0559997                                  -0.0182824                              0.00150333                                  0.0667851                                   0.0187815                             -0.0199997                            0.0606764                           0.00421002                              nan                         0.0481288
has_ibv                                    -0.0358464       -0.0636338              -0.0762865                    0.0314741           -0.0557956     1                 -0.0479441          -0.0513044       -0.0926996      -0.0697371                         -0.00610316                               -0.00610316                             -0.0145512                               -0.0140367                                        nan                      -0.00610316                              nan                  0.00915123                      -0.0161394                   -0.00610316                    -0.116484                   -0.00610316                       0.0881832                                  0.00585816                                 -0.00422909                       -0.0256826                          -0.0190637                            -0.0525111                          -0.0371898                          0.0412256                            0.0496147                            -0.0223195                                 -0.0532952                            -0.00352355                                  0.0664163                                -0.00610316                         -0.00813791                          -0.0566584                                  -0.0598122                             -0.00352355                                 -0.0185978                                  -0.0424074                             -0.0603117                           -0.0453398                          -0.00596219                              nan                        -0.00241278
num_accountants                            -0.0202141        0.0455546               0.0512935                   -0.079625             0.0975871    -0.0479441          1                  -0.127336         0.0777806       0.0109385                          0.0612506                                 0.0612506                              -0.00990637                               0.0565697                                        nan                       0.0612506                               nan                  0.0467903                        0.0459224                    0.0612506                     -0.107888                    0.00335312                      -0.0377603                                 -0.0742581                                   0.0729011                        -0.0448351                           0.042295                             -0.146849                            0.0192064                         -0.0210413                           -0.069976                              0.074576                                  -0.122687                             -0.00224239                                  0.0947559                                -0.00388406                          0.0250079                            0.0588316                                  -0.0994949                              0.0228271                                   0.0536782                                  -0.0233725                             -0.0428981                            0.066793                            0.0101565                               nan                         0.0274498
num_nacha_errors                           -0.0879775        0.114251                0.0721846                    0.284872            -0.0169929    -0.0513044         -0.127336            1               -0.0347576      -0.015985                          -0.00334803                               -0.00334803                              0.00665222                              -0.0251693                                        nan                      -0.00334803                              nan                 -0.00421948                      -0.0233552                   -0.00334803                     0.0599015                  -0.00334803                       0.309097                                  -0.00198386                                  0.0033099                         0.0319164                          -0.0195112                             0.166021                           -0.0359103                          0.0441068                            0.174113                             -0.153027                                   0.19064                              -0.00193293                                 -0.0805062                                -0.00334803                          0.0186639                            0.0121402                                   0.130967                              -0.00193293                                  0.0369473                                  -0.0226934                              0.0940115                            0.00088138                          0.0156035                               nan                         0.0137146
percent_state                              -0.00991551      -0.0127598               0.0869734                   -0.108289             0.0372913    -0.0926996          0.0777806          -0.0347576        1               0.185518                           0.00467781                                0.00467781                             -0.0274152                               -0.00963452                                       nan                       0.00467781                              nan                 -0.00931812                      -0.0106875                    0.00467781                    -0.00381173                  0.00467781                      -0.0608939                                 -0.0599668                                   0.0575744                         0.0308153                           0.0168384                            -0.0497355                           0.0486822                         -0.084216                            -0.0766551                             0.075746                                  -0.0611879                            -0.0077532                                  -0.0938258                                 0.00322091                         -0.00659294                           0.00631158                                 -0.0579203                              0.00153911                                 -0.0126452                                   0.0165573                             -0.0248777                            0.00637577                         -0.00185003                              nan                        -0.0173718
has_employees                               0.0762975       -0.0124266              -0.00245278                   0.0107              -0.0189549    -0.0697371          0.0109385          -0.015985         0.185518        1                                  0.000700364                               0.000700364                             0.00577602                              -0.00178716                                       nan                       0.000700364                             nan                  0.00088266                      -0.000447535                  0.000700364                    0.00531492                  0.000700364                      0.0140931                                  0.0152682                                  -0.0153                            0.0110573                           0.000992351                           0.0280376                           0.0209723                          0.00738451                          -0.0545516                             0.0507332                                  0.011008                              0.000404342                                -0.0173205                                 0.000700364                         0.000209011                          0.00801848                                 -0.0167826                              0.000404342                                -0.0329803                                   0.00617223                             0.000619713                          0.00764562                         -0.00412635                              nan                        -0.0298133
key_admin_DistanceFromWork_Good             0.00652735       0.000685183             0.0014163                    0.00846009           0.00260393   -0.00610316         0.0612506          -0.00334803       0.00467781      0.000700364                        1                                         1                                      -0.000950183                              0.00423855                                       nan                       1                                       nan                 -0.000121255                      0.00420307                   1                             -0.00272319                 -9.62124e-05                     -0.00226347                                -0.00334915                                  0.00333282                       -0.00151899                         -0.0016702                            -0.00433281                          0.0112091                         -0.00101445                          -0.000296824                          -0.000793089                               -0.00389164                           -5.55465e-05                                -0.00267332                               -9.62124e-05                        -0.000735845                          0.000651035                                -0.0036402                             -5.55465e-05                                 5.17002e-05                                -0.00084791                            -0.000414954                          0.000589744                        -0.000230184                             nan                        -0.000887939
key_admin_EmailageVerification_Warning      0.00652735       0.000685183             0.0014163                    0.00846009           0.00260393   -0.00610316         0.0612506          -0.00334803       0.00467781      0.000700364                        1                                         1                                      -0.000950183                              0.00423855                                       nan                       1                                       nan                 -0.000121255                      0.00420307                   1                             -0.00272319                 -9.62124e-05                     -0.00226347                                -0.00334915                                  0.00333282                       -0.00151899                         -0.0016702                            -0.00433281                          0.0112091                         -0.00101445                          -0.000296824                          -0.000793089                               -0.00389164                           -5.55465e-05                                -0.00267332                               -9.62124e-05                        -0.000735845                          0.000651035                                -0.0036402                             -5.55465e-05                                 5.17002e-05                                -0.00084791                            -0.000414954                          0.000589744                        -0.000230184                             nan                        -0.000887939
key_admin_KnownFraudulentData_Danger        0.00715942       0.00689366              0.00458373                   0.00957093           0.00982705   -0.0145512         -0.00990637          0.00665222      -0.0274152       0.00577602                        -0.000950183                              -0.000950183                             1                                        0.919868                                         nan                      -0.000950183                             nan                  0.00210268                       0.928964                    -0.000950183                   -0.000263199                -0.000295535                      0.0199334                                 -0.00999663                                  0.010217                          0.00568019                         -0.00824032                            0.00960702                          0.0235432                          0.0221075                            0.0247426                            -0.0245157                                  0.0345089                            -0.000548571                                -0.00720687                                0.000359113                         0.00677929                           0.0072861                                   0.0428324                             -0.000548571                                 0.00879019                                  0.0249571                              0.0174355                            0.00517604                         -0.00123163                              nan                         0.014974
key_admin_KnownFraudulentData_Neutral       0.00423053       0.0123477               0.00946112                  -0.0162959            0.0207977    -0.0140367          0.0565697          -0.0251693       -0.00963452     -0.00178716                         0.00423855                                0.00423855                              0.919868                                 1                                                nan                       0.00423855                              nan                  0.00640278                       0.997084                     0.00423855                    -0.0222805                   0.0146672                       -0.00801046                                -0.0183688                                   0.0183127                        -0.00549548                          0.00121141                           -0.0315783                           0.0350597                          0.0142043                            0.00395403                           -0.00518042                                -0.023416                             -0.00043773                                  0.0236989                                -0.000711569                         0.00220657                           0.0146164                                  -0.0203383                              0.000894743                                 0.0177966                                  -0.00668247                            -0.0139124                            0.0150438                           0.000368126                             nan                         0.0154238
key_admin_KnownFraudulentData_Warning     nan              nan                     nan                          nan                  nan           nan                nan                 nan              nan             nan                                nan                                       nan                                     nan                                      nan                                                nan                     nan                                       nan                nan                              nan                          nan                            nan                         nan                              nan                                        nan                                         nan                               nan                                 nan                                   nan                                 nan                                nan                                  nan                                   nan                                        nan                                   nan                                         nan                                       nan                                 nan                                  nan                                         nan                                    nan                                         nan                                         nan                                    nan                                  nan                                 nan                                       nan                       nan
key_admin_Threatmetrix_Neutral              0.00652735       0.000685183             0.0014163                    0.00846009           0.00260393   -0.00610316         0.0612506          -0.00334803       0.00467781      0.000700364                        1                                         1                                      -0.000950183                              0.00423855                                       nan                       1                                       nan                 -0.000121255                      0.00420307                   1                             -0.00272319                 -9.62124e-05                     -0.00226347                                -0.00334915                                  0.00333282                       -0.00151899                         -0.0016702                            -0.00433281                          0.0112091                         -0.00101445                          -0.000296824                          -0.000793089                               -0.00389164                           -5.55465e-05                                -0.00267332                               -9.62124e-05                        -0.000735845                          0.000651035                                -0.0036402                             -5.55465e-05                                 5.17002e-05                                -0.00084791                            -0.000414954                          0.000589744                        -0.000230184                             nan                        -0.000887939
key_admin_TorExitNode_Danger              nan              nan                     nan                          nan                  nan           nan                nan                 nan              nan             nan                                nan                                       nan                                     nan                                      nan                                                nan                     nan                                       nan                nan                              nan                          nan                            nan                         nan                              nan                                        nan                                         nan                               nan                                 nan                                   nan                                 nan                                nan                                  nan                                   nan                                        nan                                   nan                                         nan                                       nan                                 nan                                  nan                                         nan                                    nan                                         nan                                         nan                                    nan                                  nan                                 nan                                       nan                       nan
key_admin_TorExitNode_NaN                  -0.000457844      0.00591293              0.00604424                  -0.00514076           0.0032817     0.00915123         0.0467903          -0.00421948      -0.00931812      0.00088266                        -0.000121255                              -0.000121255                             0.00210268                               0.00640278                                       nan                      -0.000121255                             nan                  1                                0.00372229                  -0.000121255                   -0.003432                   -0.000121255                     -0.00285262                                -0.00422089                                  0.00420032                       -0.00191437                         -0.00210493                           -0.00546058                         -0.0105395                         -0.00127849                           0.00850775                           -0.00887836                                -0.00490458                           -7.00046e-05                                 0.00147298                               -0.000121255                         0.0016763                            0.00540167                                 -0.0045877                             -7.00046e-05                                 0.0130516                                  -0.00106861                            -0.0015081                            0.0044067                          -0.000290097                             nan                         0.00903233
key_admin_TorExitNode_Neutral               0.00457269       0.0109171               0.00792805                  -0.0150928            0.0191014    -0.0161394          0.0459224          -0.0233552       -0.0106875      -0.000447535                        0.00420307                                0.00420307                              0.928964                                 0.997084                                         nan                       0.00420307                              nan                  0.00372229                       1                            0.00420307                    -0.0200792                   0.0166356                       -0.00697523                                -0.017321                                    0.0172407                        -0.00482753                          0.00058638                           -0.0281521                           0.0419812                          0.014536                             0.00687114                           -0.00886835                                -0.0211461                            -0.000413488                                 0.0168091                                -0.00068422                          0.00177404                           0.0123106                                  -0.0186898                              0.000317761                                 0.0136025                                  -0.00586631                            -0.0130463                            0.012902                           -2.57187e-05                             nan                         0.0125591
key_admin_WebPresence_NaN                   0.00652735       0.000685183             0.0014163                    0.00846009           0.00260393   -0.00610316         0.0612506          -0.00334803       0.00467781      0.000700364                        1                                         1                                      -0.000950183                              0.00423855                                       nan                       1                                       nan                 -0.000121255                      0.00420307                   1                             -0.00272319                 -9.62124e-05                     -0.00226347                                -0.00334915                                  0.00333282                       -0.00151899                         -0.0016702                            -0.00433281                          0.0112091                         -0.00101445                          -0.000296824                          -0.000793089                               -0.00389164                           -5.55465e-05                                -0.00267332                               -9.62124e-05                        -0.000735845                          0.000651035                                -0.0036402                             -5.55465e-05                                 5.17002e-05                                -0.00084791                            -0.000414954                          0.000589744                        -0.000230184                             nan                        -0.000887939
key_company_BankRisk_Danger                 0.0975446       -0.0399741              -0.039307                     0.0663651            0.0271259    -0.116484          -0.107888            0.0599015       -0.00381173      0.00531492                        -0.00272319                               -0.00272319                             -0.000263199                             -0.0222805                                        nan                      -0.00272319                              nan                 -0.003432                        -0.0200792                   -0.00272319                     1                          -0.00272319                      -0.328917                                   0.116805                                   -0.113768                          0.136834                           -0.0511872                             0.230652                           -0.0804006                         -0.0287128                            0.050059                             -0.0660725                                  0.219537                             -0.00157218                                 -0.125934                                 -0.00272319                          0.000239733                         -0.0417338                                   0.0841939                             -0.00157218                                 -0.0503385                                  -0.0239992                              0.037107                            -0.0437814                          -0.0059054                               nan                        -0.0308148
key_company_BankRisk_NaN                   -0.00650335      -0.00268032             -0.00231908                  -0.00407904           0.00260393   -0.00610316         0.00335312         -0.00334803       0.00467781      0.000700364                       -9.62124e-05                              -9.62124e-05                            -0.000295535                              0.0146672                                        nan                      -9.62124e-05                             nan                 -0.000121255                      0.0166356                   -9.62124e-05                   -0.00272319                  1                               -0.0219327                                 -0.00334915                                  0.00333282                       -0.00151899                         -0.0016702                            -0.00433281                          0.0112091                         -0.00101445                          -0.000296824                          -0.000793089                               -0.00389164                           -5.55465e-05                                -0.0065154                                -9.62124e-05                        -0.000735845                         -0.00177232                                 -0.0036402                             -5.55465e-05                                 0.00818668                                 -0.00084791                            -0.000414954                         -0.00178858                         -0.000230184                             nan                         0.0163382
key_company_BankRisk_Neutral                0.00818886      -0.00641079             -0.0117447                    0.586742             0.0314738     0.0881832         -0.0377603           0.309097        -0.0608939       0.0140931                         -0.00226347                               -0.00226347                              0.0199334                               -0.00801046                                       nan                      -0.00226347                              nan                 -0.00285262                      -0.00697523                  -0.00226347                    -0.328917                   -0.0219327                        1                                         -0.01135                                     0.0295922                        -0.0334816                           0.0692577                             0.0342546                          -0.0261693                          0.135588                             0.118491                             -0.0979551                                  0.0898672                            -0.00130677                                 -0.01074                                  -0.00881987                         -0.00230659                          -0.0060971                                  -0.0309408                             -0.00130677                                 -0.0215044                                  -0.00982337                             0.0333384                           -0.0120653                          -0.00311585                              nan                        -0.0216091
key_company_DuplicateBankAccount_Danger     0.0486263       -0.0495403              -0.0512066                    0.0268108           -0.346178      0.00585816        -0.0742581          -0.00198386      -0.0599668       0.0152682                         -0.00334915                               -0.00334915                             -0.00999663                              -0.0183688                                        nan                      -0.00334915                              nan                 -0.00422089                      -0.017321                    -0.00334915                     0.116805                   -0.00334915                      -0.01135                                    1                                          -0.982106                          0.0950165                          -0.0195487                             0.0973547                          -0.0189133                          0.105386                             0.0670212                            -0.0748966                                  0.0711691                            -0.00193357                                 -0.0748571                                -0.00334915                          0.00569071                          -0.0321782                                   0.0161006                             -0.00193357                                 -0.0252483                                  -0.0247144                             -0.0116528                           -0.0321987                          -0.0022454                               nan                        -0.0094705
key_company_DuplicateBankAccount_Neutral   -0.048541         0.0480276               0.0495965                   -0.0247119            0.339397     -0.00422909         0.0729011           0.0033099        0.0575744      -0.0153                             0.00333282                                0.00333282                              0.010217                                 0.0183127                                        nan                       0.00333282                              nan                  0.00420032                       0.0172407                    0.00333282                    -0.113768                    0.00333282                       0.0295922                                 -0.982106                                    1                                -0.0928289                           0.0297293                            -0.0939865                           0.0178948                         -0.103232                            -0.061825                              0.0795458                                 -0.0686266                             0.00192415                                  0.0769428                                -0.00976083                         -0.00508699                           0.0319318                                  -0.015417                               0.00192415                                  0.0250314                                   0.0246499                              0.0124882                            0.0320445                           0.0023017                               nan                         0.00922166
key_company_DuplicateEin_Danger            -0.00191873      -0.0365406              -0.0341136                    0.00390647           0.0205297    -0.0256826         -0.0448351           0.0319164        0.0308153       0.0110573                         -0.00151899                               -0.00151899                              0.00568019                              -0.00549548                                       nan                      -0.00151899                              nan                 -0.00191437                      -0.00482753                  -0.00151899                     0.136834                   -0.00151899                      -0.0334816                                  0.0950165                                  -0.0928289                         1                                  -0.388647                              0.0291295                           0.0532956                         -0.0134693                            0.0897439                            -0.0463665                                  0.0321598                            -0.000876963                                -0.0273197                                -0.00151899                          0.0163541                           -0.0349179                                   0.0137357                             -0.000876963                                -0.0290101                                  -0.0133867                             -0.0224839                           -0.0264137                          -0.00338537                              nan                        -0.0160342
key_company_DuplicateEin_Neutral            0.023057         0.00123305              0.00354929                  -0.0318487           -0.0105137    -0.0190637          0.042295           -0.0195112        0.0168384       0.000992351                       -0.0016702                                -0.0016702                              -0.00824032                               0.00121141                                       nan                      -0.0016702                               nan                 -0.00210493                       0.00058638                  -0.0016702                     -0.0511872                  -0.0016702                        0.0692577                                 -0.0195487                                   0.0297293                        -0.388647                            1                                     0.0784607                           0.0312083                          0.0951014                           -0.0150249                             0.00523211                                -0.0457716                            -0.00096426                                 -0.00385521                               -0.0125471                           0.000241901                          0.0139022                                  -0.0379556                             -0.00096426                                  0.0192509                                  -0.00203867                            -0.00553835                           0.0184661                           0.00218059                              nan                         0.0165911
key_company_EinVerification_Danger          0.151786        -0.0414187              -0.0392565                    0.0746648           -0.091664     -0.0525111         -0.146849            0.166021        -0.0497355       0.0280376                         -0.00433281                               -0.00433281                              0.00960702                              -0.0315783                                        nan                      -0.00433281                              nan                 -0.00546058                      -0.0281521                   -0.00433281                     0.230652                   -0.00433281                       0.0342546                                  0.0973547                                  -0.0939865                         0.0291295                           0.0784607                             1                                  -0.24681                           -0.0260518                            0.150085                             -0.165097                                   0.122709                             -0.00250147                                 -0.21122                                  -0.00433281                          0.000898823                         -0.0411644                                   0.165138                              -0.00250147                                 -0.0777002                                   0.169368                               0.170125                            -0.0660635                           0.00296305                              nan                        -0.0452596
key_company_EinVerification_Good           -0.0592544        0.0192573               0.0247981                   -0.091533            -0.00111229   -0.0371898          0.0192064          -0.0359103        0.0486822       0.0209723                          0.0112091                                 0.0112091                               0.0235432                                0.0350597                                        nan                       0.0112091                               nan                 -0.0105395                        0.0419812                    0.0112091                     -0.0804006                   0.0112091                       -0.0261693                                 -0.0189133                                   0.0178948                         0.0532956                           0.0312083                            -0.24681                             1                                 -0.029052                            -0.076686                             -0.00749155                                -0.137341                             -0.00482811                                 -0.244199                                 -0.00836281                          0.000464375                          0.00447382                                 -0.0972657                             -0.00482811                                 -0.0346426                                  -0.0541583                             -0.0626343                            0.0230303                          -0.0125509                               nan                        -0.0106528
key_company_EinVerification_NaN            -0.0453898       -0.0116852              -0.0234295                    0.0895435            0.00761551    0.0412256         -0.0210413           0.0441068       -0.084216        0.00738451                        -0.00101445                               -0.00101445                              0.0221075                                0.0142043                                        nan                      -0.00101445                              nan                 -0.00127849                       0.014536                    -0.00101445                    -0.0287128                  -0.00101445                       0.135588                                   0.105386                                   -0.103232                         -0.0134693                           0.0951014                            -0.0260518                          -0.029052                           1                                   -0.0112841                            -0.0011286                                 -0.0110169                            -0.000585672                                -0.0245777                                -0.00101445                         -0.000192269                         -0.0112167                                   0.0229404                             -0.000585672                                -0.0198281                                  -0.0089402                             -0.000184831                         -0.00997501                         -0.0013694                               nan                        -0.0129264
key_company_FastOnboarding_Danger           0.0720017       -0.079155               -0.0919141                    0.110934            -0.18791       0.0496147         -0.069976            0.174113        -0.0766551      -0.0545516                         -0.000296824                              -0.000296824                             0.0247426                                0.00395403                                       nan                      -0.000296824                             nan                  0.00850775                       0.00687114                  -0.000296824                    0.050059                   -0.000296824                      0.118491                                   0.0670212                                  -0.061825                          0.0897439                          -0.0150249                             0.150085                           -0.076686                          -0.0112841                            1                                    -0.848987                                   0.194868                             -0.00424009                                 -0.0631123                                -0.00734429                         -0.0125529                           -0.0894478                                   0.123223                              -0.00424009                                 -0.103166                                    0.0670267                              0.0746408                           -0.0994108                           0.000949962                             nan                        -0.0768057
key_company_FastOnboarding_Neutral         -0.0828083        0.0611272               0.0739978                    0.0111548            0.186053     -0.0223195          0.074576           -0.153027         0.075746        0.0507332                         -0.000793089                              -0.000793089                            -0.0245157                               -0.00518042                                       nan                      -0.000793089                             nan                 -0.00887836                      -0.00886835                  -0.000793089                   -0.0660725                  -0.000793089                     -0.0979551                                 -0.0748966                                   0.0795458                        -0.0463665                           0.00523211                           -0.165097                           -0.00749155                        -0.0011286                           -0.848987                              1                                         -0.180299                              0.00315139                                  0.102344                                 -0.000793089                         0.0212292                            0.0752466                                  -0.12611                                0.00315139                                  0.0889575                                  -0.0681465                             -0.0760959                            0.0873223                          -0.00337006                              nan                         0.0604364
key_company_KnownFraudulentData_Danger      0.0774976        0.0294247               0.0162416                    0.204738            -0.0472078    -0.0532952         -0.122687            0.19064         -0.0611879       0.011008                          -0.00389164                               -0.00389164                              0.0345089                               -0.023416                                         nan                      -0.00389164                              nan                 -0.00490458                      -0.0211461                   -0.00389164                     0.219537                   -0.00389164                       0.0898672                                  0.0711691                                  -0.0686266                         0.0321598                          -0.0457716                             0.122709                           -0.137341                          -0.0110169                            0.194868                             -0.180299                                   1                                    -0.00224677                                 -0.133926                                 -0.00389164                         -0.00217644                          -0.00941961                                  0.241684                              -0.00224677                                 -0.0355736                                   0.0808883                              0.128149                            -0.0321036                           0.00825512                              nan                        -0.0379431
key_company_KnownFraudulentData_NaN        -0.00918487      -0.00126986             -0.00195503                  -0.00235496           0.00150333   -0.00352355        -0.00224239         -0.00193293      -0.0077532       0.000404342                       -5.55465e-05                              -5.55465e-05                            -0.000548571                             -0.00043773                                       nan                      -5.55465e-05                             nan                 -7.00046e-05                     -0.000413488                 -5.55465e-05                   -0.00157218                 -5.55465e-05                     -0.00130677                                -0.00193357                                  0.00192415                       -0.000876963                        -0.00096426                           -0.00250147                         -0.00482811                        -0.000585672                         -0.00424009                            0.00315139                                -0.00224677                            1                                           0.0095474                                -5.55465e-05                        -0.00114047                          -0.000790035                                -0.0021016                             -3.20688e-05                                -0.000158015                                -0.000489525                           -0.00159342                          -0.000803756                        -0.000132892                             nan                         0.000178004
key_company_KnownFraudulentData_Neutral    -0.0620193        0.0969731               0.0428442                   -0.0558747           -0.00738817    0.0664163          0.0947559          -0.0805062       -0.0938258      -0.0173205                         -0.00267332                               -0.00267332                             -0.00720687                               0.0236989                                        nan                      -0.00267332                              nan                  0.00147298                       0.0168091                   -0.00267332                    -0.125934                   -0.0065154                       -0.01074                                   -0.0748571                                   0.0769428                        -0.0273197                          -0.00385521                           -0.21122                            -0.244199                          -0.0245777                           -0.0631123                             0.102344                                  -0.133926                              0.0095474                                   1                                         0.012695                            0.0503263                            0.116718                                   -0.0511789                              0.00289292                                  0.148958                                   -0.0382269                             -0.0471683                            0.129105                            0.00840928                              nan                         0.0911706
key_company_KnownFraudulentData_Warning     0.00615136       0.0266476               0.0264967                   -0.00407904           0.00260393   -0.00610316        -0.00388406         -0.00334803       0.00322091      0.000700364                       -9.62124e-05                              -9.62124e-05                             0.000359113                             -0.000711569                                      nan                      -9.62124e-05                             nan                 -0.000121255                     -0.00068422                  -9.62124e-05                   -0.00272319                 -9.62124e-05                     -0.00881987                                -0.00334915                                 -0.00976083                       -0.00151899                         -0.0125471                            -0.00433281                         -0.00836281                        -0.00101445                          -0.00734429                           -0.000793089                               -0.00389164                           -5.55465e-05                                 0.012695                                  1                                  -0.00197541                           0.0228651                                  -0.00118663                            -5.55465e-05                                 0.0153455                                  -0.00084791                             0.00427509                           0.0215983                          -0.000230184                             nan                         0.00605037
key_employee_DuplicateSsn_Danger           -0.0282306        0.202791                0.19332                      0.0103034            0.0149156    -0.00813791         0.0250079           0.0186639       -0.00659294      0.000209011                       -0.000735845                              -0.000735845                             0.00677929                               0.00220657                                       nan                      -0.000735845                             nan                  0.0016763                        0.00177404                  -0.000735845                    0.000239733                -0.000735845                     -0.00230659                                 0.00569071                                 -0.00508699                        0.0163541                           0.000241901                           0.000898823                         0.000464375                       -0.000192269                         -0.0125529                             0.0212292                                 -0.00217644                           -0.00114047                                  0.0503263                                -0.00197541                          1                                    0.146855                                    0.0912967                              0.00744721                                  0.257614                                   -0.00519265                             0.244216                             0.415096                            0.0224069                               nan                         0.0888023
key_employee_DuplicateSsn_Neutral           0.0134041        0.830339                0.838248                    -0.0301183            0.0559997    -0.0566584          0.0588316           0.0121402        0.00631158      0.00801848                         0.000651035                               0.000651035                             0.0072861                                0.0146164                                        nan                       0.000651035                             nan                  0.00540167                       0.0123106                    0.000651035                   -0.0417338                  -0.00177232                      -0.0060971                                 -0.0321782                                   0.0319318                        -0.0349179                           0.0139022                            -0.0411644                           0.00447382                        -0.0112167                           -0.0894478                             0.0752466                                 -0.00941961                           -0.000790035                                 0.116718                                  0.0228651                           0.146855                             1                                           0.279178                               0.018797                                    0.658447                                    0.131814                               0.404927                             0.930043                            0.150932                                nan                         0.297901
key_employee_KnownFraudulentData_Danger     0.0325799        0.332714                0.310708                     0.0300892           -0.0182824    -0.0598122         -0.0994949           0.130967        -0.0579203      -0.0167826                         -0.0036402                                -0.0036402                               0.0428324                               -0.0203383                                        nan                      -0.0036402                               nan                 -0.0045877                       -0.0186898                   -0.0036402                      0.0841939                  -0.0036402                       -0.0309408                                  0.0161006                                  -0.015417                          0.0137357                          -0.0379556                             0.165138                           -0.0972657                          0.0229404                            0.123223                             -0.12611                                    0.241684                             -0.0021016                                  -0.0511789                                -0.00118663                          0.0912967                            0.279178                                    1                                      0.00214797                                  0.252425                                    0.64825                                0.613095                             0.196968                            0.0213381                               nan                         0.222277
key_employee_KnownFraudulentData_NaN       -0.00652819       0.0120536               0.0128327                   -0.00235496           0.00150333   -0.00352355         0.0228271          -0.00193293       0.00153911      0.000404342                       -5.55465e-05                              -5.55465e-05                            -0.000548571                              0.000894743                                      nan                      -5.55465e-05                             nan                 -7.00046e-05                      0.000317761                 -5.55465e-05                   -0.00157218                 -5.55465e-05                     -0.00130677                                -0.00193357                                  0.00192415                       -0.000876963                        -0.00096426                           -0.00250147                         -0.00482811                        -0.000585672                         -0.00424009                            0.00315139                                -0.00224677                           -3.20688e-05                                 0.00289292                               -5.55465e-05                         0.00744721                           0.018797                                    0.00214797                             1                                           0.0136499                                  -0.000489525                           -0.00159342                           0.0197925                          -0.000132892                             nan                         0.00639376
key_employee_KnownFraudulentData_Neutral   -0.0303068        0.651146                0.634062                    -0.0226445            0.0667851    -0.0185978          0.0536782           0.0369473       -0.0126452      -0.0329803                          5.17002e-05                               5.17002e-05                             0.00879019                               0.0177966                                        nan                       5.17002e-05                             nan                  0.0130516                        0.0136025                    5.17002e-05                   -0.0503385                   0.00818668                      -0.0215044                                 -0.0252483                                   0.0250314                        -0.0290101                           0.0192509                            -0.0777002                          -0.0346426                         -0.0198281                           -0.103166                              0.0889575                                 -0.0355736                            -0.000158015                                 0.148958                                  0.0153455                           0.257614                             0.658447                                    0.252425                               0.0136499                                   1                                          -0.00948538                             0.230348                             0.668153                            0.0888212                               nan                         0.869641
key_employee_KnownFraudulentData_Warning    0.110036         0.154056                0.173475                    -0.0183651            0.0187815    -0.0424074         -0.0233725          -0.0226934        0.0165573       0.00617223                        -0.00084791                               -0.00084791                              0.0249571                               -0.00668247                                       nan                      -0.00084791                              nan                 -0.00106861                      -0.00586631                  -0.00084791                    -0.0239992                  -0.00084791                      -0.00982337                                -0.0247144                                   0.0246499                        -0.0133867                          -0.00203867                            0.169368                           -0.0541583                         -0.0089402                            0.0670267                            -0.0681465                                  0.0808883                            -0.000489525                                -0.0382269                                -0.00084791                         -0.00519265                           0.131814                                    0.64825                               -0.000489525                                -0.00948538                                  1                                      0.705089                             0.00897828                         -0.00189959                              nan                        -0.00681766
key_employee_SsnVerification_Danger         0.100372         0.450348                0.461706                     0.0323645           -0.0199997    -0.0603117         -0.0428981           0.0940115       -0.0248777       0.000619713                       -0.000414954                              -0.000414954                             0.0174355                               -0.0139124                                        nan                      -0.000414954                             nan                 -0.0015081                       -0.0130463                   -0.000414954                    0.037107                   -0.000414954                      0.0333384                                 -0.0116528                                   0.0124882                        -0.0224839                          -0.00553835                            0.170125                           -0.0626343                         -0.000184831                          0.0746408                            -0.0760959                                  0.128149                             -0.00159342                                 -0.0471683                                 0.00427509                          0.244216                             0.404927                                    0.613095                              -0.00159342                                  0.230348                                    0.705089                               1                                    0.303743                            0.0103029                               nan                         0.08091
key_employee_SsnVerification_Good          -0.0102386        0.79009                 0.794088                    -0.0286453            0.0606764    -0.0453398          0.066793            0.00088138       0.00637577      0.00764562                         0.000589744                               0.000589744                             0.00517604                               0.0150438                                        nan                       0.000589744                             nan                  0.0044067                        0.012902                     0.000589744                   -0.0437814                  -0.00178858                      -0.0120653                                 -0.0321987                                   0.0320445                        -0.0264137                           0.0184661                            -0.0660635                           0.0230303                         -0.00997501                          -0.0994108                             0.0873223                                 -0.0321036                            -0.000803756                                 0.129105                                  0.0215983                           0.415096                             0.930043                                    0.196968                               0.0197925                                   0.668153                                    0.00897828                             0.303743                             1                                   0.0442493                               nan                         0.295469
key_employee_SsnVerification_NaN           -0.0032464        0.0624301               0.0528972                   -0.00279517           0.00421002   -0.00596219         0.0101565           0.0156035       -0.00185003     -0.00412635                        -0.000230184                              -0.000230184                            -0.00123163                               0.000368126                                      nan                      -0.000230184                             nan                 -0.000290097                     -2.57187e-05                 -0.000230184                   -0.0059054                  -0.000230184                     -0.00311585                                -0.0022454                                   0.0023017                        -0.00338537                          0.00218059                            0.00296305                         -0.0125509                         -0.0013694                            0.000949962                          -0.00337006                                 0.00825512                           -0.000132892                                 0.00840928                               -0.000230184                         0.0224069                            0.150932                                    0.0213381                             -0.000132892                                 0.0888212                                  -0.00189959                             0.0103029                            0.0442493                           1                                       nan                         0.0279605
key_employee_TorExitNode_NaN              nan              nan                     nan                          nan                  nan           nan                nan                 nan              nan             nan                                nan                                       nan                                     nan                                      nan                                                nan                     nan                                       nan                nan                              nan                          nan                            nan                         nan                              nan                                        nan                                         nan                               nan                                 nan                                   nan                                 nan                                nan                                  nan                                   nan                                        nan                                   nan                                         nan                                       nan                                 nan                                  nan                                         nan                                    nan                                         nan                                         nan                                    nan                                  nan                                 nan                                       nan                       nan
key_employee_TorExitNode_Neutral           -0.0253915        0.327251                0.309721                    -0.0165556            0.0481288    -0.00241278         0.0274498           0.0137146       -0.0173718      -0.0298133                         -0.000887939                              -0.000887939                             0.014974                                 0.0154238                                        nan                      -0.000887939                             nan                  0.00903233                       0.0125591                   -0.000887939                   -0.0308148                   0.0163382                       -0.0216091                                 -0.0094705                                   0.00922166                       -0.0160342                           0.0165911                            -0.0452596                          -0.0106528                         -0.0129264                           -0.0768057                             0.0604364                                 -0.0379431                             0.000178004                                 0.0911706                                 0.00605037                          0.0888023                            0.297901                                    0.222277                               0.00639376                                  0.869641                                   -0.00681766                             0.08091                              0.295469                            0.0279605                               nan                         1
========================================  =============  ===============  ======================  ==========================  ===================  ============  =================  ==================  ===============  ===============  =================================  ========================================  ======================================  =======================================  =======================================  ================================  ==============================  ===========================  ===============================  ===========================  =============================  ==========================  ==============================  =========================================  ==========================================  =================================  ==================================  ====================================  ==================================  =================================  ===================================  ====================================  ========================================  =====================================  =========================================  =========================================  ==================================  ===================================  =========================================  ======================================  ==========================================  ==========================================  =====================================  ===================================  ==================================  ==============================  ==================================



========  ============  ===============  ======================  ==========================  ===================  ==========  =================  ==================  ===============  ===============  =================================  ========================================  ======================================  =======================================  =======================================  ================================  ==============================  ===========================  ===============================  ===========================  =============================  ==========================  ==============================  =========================================  ==========================================  =================================  ==================================  ====================================  ==================================  =================================  ===================================  ====================================  ========================================  =====================================  =========================================  =========================================  ==================================  ===================================  =========================================  ======================================  ==========================================  ==========================================  =====================================  ===================================  ==================================  ==============================  ==================================  ==========
index       company_id    num_employees    num_ee_state_matches    num_bank_account_changes    bank_account_type     has_ibv    num_accountants    num_nacha_errors    percent_state    has_employees    key_admin_DistanceFromWork_Good    key_admin_EmailageVerification_Warning    key_admin_KnownFraudulentData_Danger    key_admin_KnownFraudulentData_Neutral    key_admin_KnownFraudulentData_Warning    key_admin_Threatmetrix_Neutral    key_admin_TorExitNode_Danger    key_admin_TorExitNode_NaN    key_admin_TorExitNode_Neutral    key_admin_WebPresence_NaN    key_company_BankRisk_Danger    key_company_BankRisk_NaN    key_company_BankRisk_Neutral    key_company_DuplicateBankAccount_Danger    key_company_DuplicateBankAccount_Neutral    key_company_DuplicateEin_Danger    key_company_DuplicateEin_Neutral    key_company_EinVerification_Danger    key_company_EinVerification_Good    key_company_EinVerification_NaN    key_company_FastOnboarding_Danger    key_company_FastOnboarding_Neutral    key_company_KnownFraudulentData_Danger    key_company_KnownFraudulentData_NaN    key_company_KnownFraudulentData_Neutral    key_company_KnownFraudulentData_Warning    key_employee_DuplicateSsn_Danger    key_employee_DuplicateSsn_Neutral    key_employee_KnownFraudulentData_Danger    key_employee_KnownFraudulentData_NaN    key_employee_KnownFraudulentData_Neutral    key_employee_KnownFraudulentData_Warning    key_employee_SsnVerification_Danger    key_employee_SsnVerification_Good    key_employee_SsnVerification_NaN    key_employee_TorExitNode_NaN    key_employee_TorExitNode_Neutral    is_fraud
========  ============  ===============  ======================  ==========================  ===================  ==========  =================  ==================  ===============  ===============  =================================  ========================================  ======================================  =======================================  =======================================  ================================  ==============================  ===========================  ===============================  ===========================  =============================  ==========================  ==============================  =========================================  ==========================================  =================================  ==================================  ====================================  ==================================  =================================  ===================================  ====================================  ========================================  =====================================  =========================================  =========================================  ==================================  ===================================  =========================================  ======================================  ==========================================  ==========================================  =====================================  ===================================  ==================================  ==============================  ==================================  ==========
is_fraud     0.0697591       -0.0195536              -0.0312704                    0.222475            -0.270617  -0.0465762          -0.312557            0.389618        -0.184139       -0.0316979                        -0.00820879                               -0.00820879                              0.00977301                               -0.0654656                                      nan                       -0.00820879                             nan                   -0.0103454                        -0.059774                  -0.00820879                       0.319135                 -0.00820879                        0.126692                                   0.225494                                   -0.218403                           0.137805                          -0.0846414                              0.376094                           -0.138176                          0.0501074                             0.348064                             -0.313563                                  0.409762                             -0.0047392                                  -0.205312                                -0.00820879                         -0.00255209                           -0.0546372                                   0.303204                              -0.0047392                                   -0.118811                                   0.0786798                               0.175145                           -0.0794113                        -0.000578977                             nan                           -0.096581           1
========  ============  ===============  ======================  ==========================  ===================  ==========  =================  ==================  ===============  ===============  =================================  ========================================  ======================================  =======================================  =======================================  ================================  ==============================  ===========================  ===============================  ===========================  =============================  ==========================  ==============================  =========================================  ==========================================  =================================  ==================================  ====================================  ==================================  =================================  ===================================  ====================================  ========================================  =====================================  =========================================  =========================================  ==================================  ===================================  =========================================  ======================================  ==========================================  ==========================================  =====================================  ===================================  ==================================  ==============================  ==================================  ==========


.. figure:: ./images/corr_heatmap.png
    :align: center

`Correlation heatmap`

.. figure:: ./images/corr_heatmap_mag.png
    :align: center

`Correlation magnitude heatmap`


Note
    The nan values present here are features that existed in the orignal data set but were lost during resampling. For example there is only one record in the risks table of admin + KnownFraudulentData + Warning which is lost during resampling and consequently produces nans during correlation. The nans are left as records that the data is possible to exist, and could be useful in future models if more events of the type are recorded. 

==============
Recommendation
==============

For more information please see :py:meth:`gusto.src.preprocessor.ModelOwner.build`

For more information please see :py:meth:`gusto.src.preprocessor.ModelOwner.evaluate`

Feature Selection
=================

For more information please see :py:func:`gusto.src.helpers.select_transform_features`

Feature reduction is performed leveraging a Linear Support Vector Classifier after mean imputation followed by mean centering and standard deviation scaling. Scaling is additionally useful here as it will improve the ability to compare the impact of features via Logistic Regression (one of the modeling techniques presented next) through the magnitude and direction of features' coefficients. Producing a feature space of the form:


==========================  ===================  =================  ==================  ===============  =============================  ==============================  =========================================  =================================  ==================================  ====================================  ==================================  ===================================  ========================================  =========================================  =========================================  ==========================================  =====================================
  num_bank_account_changes    bank_account_type    num_accountants    num_nacha_errors    percent_state    key_company_BankRisk_Danger    key_company_BankRisk_Neutral    key_company_DuplicateBankAccount_Danger    key_company_DuplicateEin_Danger    key_company_DuplicateEin_Neutral    key_company_EinVerification_Danger    key_company_EinVerification_Good    key_company_FastOnboarding_Danger    key_company_KnownFraudulentData_Danger    key_company_KnownFraudulentData_Neutral    key_employee_KnownFraudulentData_Danger    key_employee_KnownFraudulentData_Neutral    key_employee_SsnVerification_Danger
==========================  ===================  =================  ==================  ===============  =============================  ==============================  =========================================  =================================  ==================================  ====================================  ==================================  ===================================  ========================================  =========================================  =========================================  ==========================================  =====================================
                 -0.421065              0.26013           6.24331            -0.334495         0.476303                      -0.278153                       -0.242752                                  -0.343739                          -0.157541                           -0.162886                              -0.44119                            1.14803                              1.40757                                   -0.39625                                  -0.661548                                  -0.369697                                  -0.224444                                0.426636
                 -0.421065              0.26013           1.81686            -0.334495         0.476303                      -0.278153                       -0.242752                                  -0.343739                          -0.157541                           -0.162886                              -0.44119                           -0.847882                            -0.750208                                  -0.39625                                   1.10474                                   -0.369697                                  -0.32388                                -0.27983
                 -0.421065              0.26013          -0.396369           -0.334495         0.476303                      -0.278153                       -0.242752                                  -0.343739                          -0.157541                            3.1942                                -0.44119                           -0.847882                            -0.750208                                  -0.39625                                   0.515974                                  -0.369697                                  -0.0255732                              -0.27983
                  1.41298               0.26013           1.81686            -0.334495         0.249952                      -0.278153                        1.68188                                   -0.343739                          -0.157541                            3.1942                                -0.44119                            1.14803                             -0.750208                                  -0.39625                                  -0.661548                                   0.37927                                    5.09536                                -0.27983
                 -0.421065              0.26013          -0.396369           -0.334495         0.476303                      -0.278153                       -0.242752                                  -0.343739                          -0.157541                           -0.162886                              -0.44119                            1.14803                              1.40757                                   -0.39625                                   0.515974                                  -0.369697                                  -0.32388                                -0.27983
==========================  ===================  =================  ==================  ===============  =============================  ==============================  =========================================  =================================  ==================================  ====================================  ==================================  ===================================  ========================================  =========================================  =========================================  ==========================================  =====================================


Modeling
========

For more information please see :py:meth:`gusto.src.preprocessor.ModelOwner.grid_search`

Two modeling techniques are employed to predict fraud and gain better understanding of the available signal's ability to indicate fraud. 

    * **Logistic Regression** 
    * **Random Forest**
    * **Support Vector Classifier**

Each model is hyperparameter tuned with a cross validated grid search with coarse to fine evolution optimizing for area under the Receiver Operator Characteristic curve.(Note due to fitting time SVC was not extensively grid searched, however based on results should be focused on moving forward)  With information about the cost of false positives and false negatives as well as growth/ opportunity
costs, a profit curve can be constructed to find the optimal thresholding level. Without that information I note that false negatives are likely more costly
than false positives so when comparing models in addition to evaluating AUC, the location of the values on the curve is also important.

Non grid searched parameters are default unless otherwise noted.

Logistic Regression
-------------------
    
Grid searched parameters: penalty = 'l2'  , C = 193 (note C parameter search was based off of log spacing)

ROC AUC scores wth grid searched params (10 fold): mean: 0.98, std: 0.001


.. figure:: ./images/logistic_roc.png
    :align: center

`Logistic Regression ROC curve with grid searched param`

ROC AUC on test set: 0.92

Random Forest                 
-------------

Not searched parameters: n_jobs=-1 for computing resources. n_estimators=100. Holding all other parameters fixed, increasing the number of estimators will not increase
Random Forest overfitting (unlike boosting trees, though XG Boosted trees would be a good choice of the next model to investigate)

Grid searched parameters: min_samples_split: 100, max_depth: 15

ROC AUC scores wth grid searched params (10 fold): mean: 0.99 std: .001

.. figure:: ./images/random_forest_roc.png
    :align: center

`Random Forest ROC curve with grid searched param`

ROC AUC on test set: .91


Support Vector Classifier
-------------------------

Kernel was not grid searched, an RBF kernel was used (as mentioned above, with more time, tuning
SVC is a promising avenue to persue for predictive modeling capabilities)

Grid searched parameters: C: 100, gamma: 0.01

ROC AUC scores wth grid searched params (10 fold): mean: 0.99, std: 0.001


.. figure:: ./images/svc_roc.png
    :align: center

`Support Vector Classifier ROC curve with grid searched param`

ROC AUC on test set: 0.93

Test Set ROC curve
------------------

.. figure:: ./images/test_roc.png
    :align: center

Moving forward for pure predictive power, the SVC looks to be the most promising especially because it is the least tuned of the three models currently.

Also note, that despite over/undersampling the models are still feeling negative effects from
the class imbalance and have overfitting characteristics in the test set. Optimizing parameter tuning
throughout the process requires more attention moving forward.

Signal Importances
==================

With the data centered and scaled Logistic Regressions coefficeints indicate the contribution a step in an independent variable has to the outcome.
Random Forests are able to convey feature importance by evaluating the information gain associated with each feature ensembled over the collection of trees. However, the weights are not able to convey direction. As a result we prioritize the weights from Logistic Regression.
The L1 norms of of the weights are presented here:

========================================  =============  ===================
Feature                                   RandomForest   Logistic Regression
========================================  =============  ===================
num_bank_account_changes                  0.015187         0.0142189
bank_account_type                         0.0298531       -0.0571144
num_accountants                           0.0178421       -0.0850882
num_nacha_errors                          0.121224         0.165705
percent_state                             0.0125712       -0.0289843
key_company_BankRisk_Danger               0.0404157        0.127196
key_company_BankRisk_Neutral              0.0401948        0.034026
key_company_DuplicateBankAccount_Danger   0.0141386        0.024399
key_company_DuplicateEin_Danger           0.00183285       0.00266887
key_company_DuplicateEin_Neutral          0.00474925      -0.0161151
key_company_EinVerification_Danger        0.0643888        0.0315414
key_company_EinVerification_Good          0.0217702       -0.0208401
key_company_FastOnboarding_Danger         0.13832          0.0384885
key_company_KnownFraudulentData_Danger    0.177669         0.101789
key_company_KnownFraudulentData_Neutral   0.0414613       -0.0325138
key_employee_KnownFraudulentData_Danger   0.13522          0.102968
key_employee_KnownFraudulentData_Neutral  0.0325182       -0.0705589
key_employee_SsnVerification_Danger       0.0906433        0.0457851
========================================  =============  ===================


For a more in depth statistical summary of signals statsmodels summary of Logistic Regression (not regularized) is presented below


========================================== ========== ========== ========== =========== ====================
Feature                                        coef    std err          z      P>|z|      [95.0% Conf. Int.]
========================================== ========== ========== ========== =========== ====================
num_bank_account_changes                     0.1476      0.028      5.248      0.000         0.092     0.203
bank_account_type                           -0.7607      0.030    -25.607      0.000        -0.819    -0.703
num_accountants                             -1.2871      0.050    -25.714      0.000        -1.385    -1.189
num_nacha_errors                             2.0580      0.050     40.990      0.000         1.960     2.156
percent_state                               -0.4083      0.021    -19.568      0.000        -0.449    -0.367
has_employees                               -0.0963      0.015     -6.321      0.000        -0.126    -0.066
key_company_BankRisk_Danger                  1.6093      0.063     25.491      0.000         1.486     1.733
key_company_BankRisk_Neutral                 0.4692      0.032     14.728      0.000         0.407     0.532
key_company_DuplicateBankAccount_Danger      0.2834      0.024     11.857      0.000         0.237     0.330
key_company_DuplicateEin_Danger              0.0654      0.034      1.929      0.054        -0.001     0.132
key_company_DuplicateEin_Neutral            -0.1937      0.029     -6.768      0.000        -0.250    -0.138
key_company_EinVerification_Danger           0.4298      0.023     18.513      0.000         0.384     0.475
key_company_EinVerification_Good            -0.2636      0.025    -10.540      0.000        -0.313    -0.215
key_company_FastOnboarding_Danger            0.5130      0.021     24.340      0.000         0.472     0.554
key_company_KnownFraudulentData_Danger       1.3243      0.038     34.830      0.000         1.250     1.399
key_company_KnownFraudulentData_Neutral     -0.4224      0.033    -12.917      0.000        -0.486    -0.358
key_employee_KnownFraudulentData_Danger      1.4197      0.045     31.773      0.000         1.332     1.507
key_employee_KnownFraudulentData_Neutral    -1.1974      0.053    -22.418      0.000        -1.302    -1.093
key_employee_SsnVerification_Danger          0.6232      0.037     17.026      0.000         0.551     0.695
========================================== ========== ========== ========== =========== ====================

Takeaways
---------

Companies with more back account changes, companies linking checking accounts, and especially companies with more **nacha errors** are at a higher risk of being fraudulent. As well are companies with fewer accounts, and companies with a smaller percentage of employees located in the companies home state (Note, this is an area to explore more moving forward, particularly with topic modeling and partitioning, this is not a linear relationship and establishing company profiles as a function of size among other attributes would be beneficial)

With respect to risk metric evaluations the Gusto risk team should focus on metrics where *Danger* rating has been triggered, partularly for *companies* or *employees* with *Known Fraudulent Data* as well as  companies with *Bank Risk Danger attributions*.
Suplemented by companies with *Fast Onboarding Danger*

===========
New Signals
===========

There are a variety of signals to investigate, collect and build with, but my primary approach centers around verifying the authenticity of a new company. 
Web scraping data about the company (company website, references in established online publications, leveraging social graphs) in an attempt to establish a metric similar to eigenvector centrality = is this company connected to other non fraudulent entities.
Additionally, if possible, leveraging the existing network of Gusto Customers via referral to help authenticate and promote other good actors via reference could be very beneficial. 
